<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Repositories are components that encapsulate the logic required to access data sources. They decouple data access logic and technology from domain logic. This article describes the Repository Design Pattern in the context of Domain Driven Design.">
    <meta name="robots" content="index, archive">
    <meta property="og:title" content="Enterprise Software Blog"/>
    <meta property="og:locale" content="en_US"/>
    <meta name="description" content="A place for discussing about software."/>
    <meta property="og:description" content="A place for discussing about software."/>
    <meta property="og:url" content="/"/>
    <meta property="og:site_name" content="Enterprise Software Blog"/>
    <meta name="twitter:card" content="summary"/>
    <meta property="twitter:title" content="Enterprise Software Blog"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="shortcut icon" type="image/x-icon" href="/assets/favicons/favicon.ico"/>
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="canonical" href="https://github.com/abbasamiri/abbasamiri.github.io"/>
    <link rel="stylesheet" href="/assets/css/site.css">
    <title>Enterprise Software Blog  - Repository in Domain Driven Design</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-179743488-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-179743488-1');
    </script>
</head>
<body>
<header class="Header">
    <div class="Header-item">
        <a href="/" class="Header-link f4 d-flex flex-items-center font-fugaz-one">
            Enterprise Software Blog
        </a>
    </div>
    <div class="Header-item Header-item--full">
    </div>
    <div class="Header-item mr-0">
        <a href="/feed.xml" target="_blank">
            <img src="/assets/images/rss-icon.png" alt="RSS">
        </a>
    </div>
</header>
<div class="container-xl clearfix">
    <div class="col-12 col-xl-3 col-md-3 col-sm-12 col-lg-3 float-left">
        <div class="Box m-2 color-shadow-medium">
    <div class="Box-body">
        <img src="/assets/images/abbas-amiri.jpg" alt="Abbas Amiri"
             style="width: 150px; height: auto; display:block;margin:auto;">
        <p></p>
        <h3 class="text-center">Abbas Amiri</h3>
        <h3 class="text-center">Software Engineer</h3>
        <p></p>
        <p class="text-center">
            <a href="mailto://abbas.amiri@outlook.com" title="Email" target="_blank"><i class="icon-mail"></i></a>
            <a href="https://github.com/abbasamiri" title="Github" target="_blank"><i
                        class="icon-github-circled"></i></a>
            <a href="https://stackoverflow.com/users/2234569/abbas-amiri" title="Stackoverflow" target="_blank"><i
                        class="icon-stackoverflow-1"></i></a>
            <a href="https://twitter.com/AbbasAmirii" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>
        </p>
    </div>
</div>

<div class="Box m-2 color-shadow-medium">
    <div class="Box-body" id="quote" style="display: none">
        <p id="quote-text"></p>
        <p id="quote-author"></p>
    </div>
</div>

<script>
    var getJSON = function (url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload = function () {
            var status = xhr.status;
            if (status === 200) {
                callback(null, xhr.response);
            } else {
                callback(status, xhr.response);
            }
        };
        xhr.send();
    };
    getJSON('/assets/data/quotes.json', function (err, data) {
        if (err === null) {
            var element = document.getElementById('quote');
            element.style.display = 'block'
            var random = Math.floor(Math.random() * (data.length - 1));
            document.getElementById('quote-text').innerText = data[random].quote;
            document.getElementById('quote-author').innerText = '-- ' + data[random].author;
        }
    });
</script>

    </div>
    <div class="col-12 col-xl-9 col-md-9 col-sm-12 col-lg-9 float-left">
        <div class="Box m-2 color-shadow-medium text-justify">
    <article class="Box-body">
        <header>
            <h2>Repository in Domain Driven Design</h2>
            <p class="color-gray-5"><i class="icon-calendar-outlilne"></i> Sun Oct 25 2020</p>
        </header>
        <hr>
        <section class="markdown-body">
            <p><img src="/assets/images/article-image-1.jpg" alt=""></p>
<p>Enterprise applications often have complex data which need to persist. Data persistence has been a challenging issue in software production. Having an appropriate data persistent mechanism could be one of some factors which leads to having a successful software product. There are some design patterns related to data persistent, in this article I will try to describe some of them focusing on <em>Repository</em> one.</p>
<p><em>Repository Design Pattern</em> mostly lives in the context of <em>Domain Driven Design</em> in collaboration with some architectural patterns like <em>Layered Architecture</em>, <em>Domain Models</em>, <em>Service Layer</em>, <em>Data Mapper</em>, <em>Unit of Work</em> which will be described briefly to have common understanding of these patterns.</p>
<h4 id="domain-driven-design" tabindex="-1">Domain Driven Design <a class="direct-link" href="#domain-driven-design" aria-hidden="true">#</a></h4>
<p>Domain Driven Design (DDD) is an approach to developing software for complex needs by deeply connecting the implementation to an evolving model of the core business concepts. The term was coined by Eric Evans in his <a href="https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">book</a> of the same title. <em>Context</em>, <em>Domain</em>, <em>Model</em>, <em>Ubiquitous Language</em> are basic concepts in DDD.</p>
<h4 id="layered-architecture" tabindex="-1">Layered Architecture <a class="direct-link" href="#layered-architecture" aria-hidden="true">#</a></h4>
<p>An application has some components that perform specific tasks. <em>Layered Architecture</em> organizes these components in a level that components with specific concern are in the same layer. For instance, the presentation layer consists of all components which build the user-interface, the persistent layer is a collection of components that perform data persistence and so on. Layers communicate with each other in a certain way, the structure of architecture defines the direction of communication between layers.</p>
<h4 id="domain-models" tabindex="-1">Domain Models <a class="direct-link" href="#domain-models" aria-hidden="true">#</a></h4>
<p>Martin Fowler in his book <a href="https://www.amazon.com/Patterns-Enterprise-Application-Architecture-Martin/dp/0321127420/">Patterns of Enterprise Application Architecture</a> describes three patterns to organizing domain logic: <em>Transaction Script</em>, <em>Domain Model</em> and <em>Table Module</em>. The Domain Model is what we are interested in, which is classes for nouns in the domain. For instance, <em>Customer</em> is an <em>Entity</em> in a domain model in an ordering system. Domain Model should handle all data and business related to its concept.</p>
<h4 id="service-layer" tabindex="-1">Service Layer <a class="direct-link" href="#service-layer" aria-hidden="true">#</a></h4>
<blockquote>
<p>Defines an application’s boundary with a layer of services that establishes a set of available operations and coordinates the application’s response in each operation.</p>
<p>— <cite><a href="https://martinfowler.com/eaaCatalog/serviceLayer.html">Service Layer</a></cite></p>
</blockquote>
<p><img src="/assets/images/article-image-3.gif" alt="Service Layer"></p>
<p>Service Layer is where the application’s operations take place. This layer encapsulates application business logic, controlling transactions, workflow logic and every activity that is related to the application so it could be called <em>Application Service Layer</em>. The layer exploits repositories to perform its job.</p>
<h4 id="unit-of-work" tabindex="-1">Unit of Work <a class="direct-link" href="#unit-of-work" aria-hidden="true">#</a></h4>
<blockquote>
<p>Maintains a list of objects affected by a business transaction and coordinates the writing out of changes and the resolution of concurrency problems.</p>
<p>— <cite><a href="https://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a></cite></p>
</blockquote>
<p>The main purpose of <code>Unit of Work</code> is to manage transactions in a way that repositories are free from this concern. Repositories can be part of a transaction, but being ignorant about it.</p>
<h4 id="repository" tabindex="-1">Repository <a class="direct-link" href="#repository" aria-hidden="true">#</a></h4>
<blockquote>
<p>Mediates between the domain and data mapping layers using a collection-like interface for accessing domain objects.</p>
<p>— <cite><a href="https://martinfowler.com/eaaCatalog/repository.html">Repository</a></cite></p>
</blockquote>
<p>Repositories are components that encapsulate the logic required to access data sources. They decouple data access logic and technology from domain logic.</p>
<p>Normally every <em>Aggregate Domain Model</em> has a repository. Martin Fowler describes <em>Aggregate</em> or <em>Aggregate root</em> as below:</p>
<blockquote>
<p>Aggregate is a pattern in Domain-Driven Design. A DDD aggregate is a cluster of domain objects that can be treated as a single unit.</p>
<p><cite><a href="https://martinfowler.com/bliki/DDD_Aggregate.html">DDD_Aggregate</a></cite></p>
</blockquote>
<p>This is important that every aggregate in the domain model should have one repository which maintains transnational consistency between all the objects within the aggregate.</p>
<p>I tend to think about repositories - as Martin Fowler describes it - as a mediator between domain and data mapper, but what is <em>Data Mapper</em>?</p>
<blockquote>
<p>A layer of Mappers that moves data between objects and a database while keeping them independent of each other and the mapper itself.</p>
<p><cite><a href="https://martinfowler.com/eaaCatalog/dataMapper.html">Data Mapper</a></cite></p>
</blockquote>
<p>Inside the repository, data mapper performs its job to retrieve and persist data to data source(s).</p>
<p>Data sources are mostly somewhere outside of your application like SqlServer, Oracle, MongoDB and so on, they may have different mechanisms to structure data. Applications need a mechanism to communicate with these external data sources, this mechanism is called <em>Data Mapper</em>. It is like a bridge between the application and the data source. Objects and data sources have different mechanisms for structuring data. For instance, Relational databases do not support inheritance or collections. Data mapper is responsible for transferring data between objects and data sources in a way that these concepts are ignorant about each other.</p>
<h4 id="repository-and-transactions" tabindex="-1">Repository and Transactions <a class="direct-link" href="#repository-and-transactions" aria-hidden="true">#</a></h4>
<p><img src="/assets/images/article-image-2.png" alt="Repository and Unit of Work"></p>
<p>The above diagram shows that the <em>Unit of Work</em> manages transactions for two repositories which one of them is an aggregate repository.</p>
<p>Service Layer uses repositories to perform its operations. Transaction over repositories should be handled by <em>Service Layer</em> via <em>Unit of Work</em>.</p>
<h4 id="repository-design" tabindex="-1">Repository design <a class="direct-link" href="#repository-design" aria-hidden="true">#</a></h4>
<p>Repositories should be defined based on its consumer needs which is based on use-cases. Having general and unified methods in a repository is not a good idea because not all aggregates have the same needs, it is also possible that general repositories have leaky abstraction. It is always tempting to design repositories for the sake of code-reuse, but this kind of code-reuse pollutes repositories with useless methods that throws the<br>
<code>NotImplementedException</code>. For instance, imagine that we have a General Repository - in C# -like this:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>TAggregate<span class="token punctuation">,</span> TId<span class="token punctuation">></span></span></span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>TAggregate<span class="token punctuation">></span></span> <span class="token function">FindAllMatching</span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">></span><span class="token punctuation">></span></span> query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>TAggregate<span class="token punctuation">></span></span> <span class="token function">FindAllMatching</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name">TAggregate</span> <span class="token function">FindBy</span><span class="token punctuation">(</span><span class="token class-name">TId</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">TAggregate</span> aggregate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Remove</span><span class="token punctuation">(</span><span class="token class-name">TAggregate</span> aggregate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Well, the definition is a good idea for code-reuse ,but a bad one for repository. The first problem is that some aggregates may be read-only, so <code>Add</code> and <code>Remove</code> methods are useless and the implementation must throws the <code>NotImplementedException</code>. The second problem is that <code>FindAllMatching(string query)</code> has leaky abstraction, the method is open to extension and you have no control to query optimization and fetching strategies.</p>
<h4 id="can-repository-be-replaced-with-orm%3F" tabindex="-1">Can Repository be replaced with ORM? <a class="direct-link" href="#can-repository-be-replaced-with-orm%3F" aria-hidden="true">#</a></h4>
<p>Domain models are more than a <em>Plain Object</em> that ORMs use to store data. They can not be replaced.</p>
<p>Robert C Martin said:</p>
<blockquote>
<p>The biggest problem with ORM’s is that they don’t really map O to R. Tables <em>are not</em> objects. They never were; and never will be.</p>
<p><cite><a href="https://twitter.com/unclebobmartin/status/384682249301811200?lang=en">Twitter</a></cite></p>
</blockquote>
<p>The relations between domain models - mostly - is different from relations between database objects. The main purpose of domain models is supporting use-cases not the structure of database objects.</p>
<p>If you are using <em>Domain Driven Design (DDD)</em> in your project, you meant to use Repository. It makes you follow principle and have clean code, replacing Repository with ORM should be avoided.</p>
<h4 id="meaningful-contract" tabindex="-1">Meaningful contract <a class="direct-link" href="#meaningful-contract" aria-hidden="true">#</a></h4>
<p>Repository is not a CRUD interface, it should not be designed with data-storage’s vocabulary.<br>
It is something that domain experts can understand for the sake of <em>Ubiquitous Language</em>. The repository contract should be specific in the way that developers understand the purpose of a method without exploring the code. A repository comes from the need of use-cases, so it should be specific and understandable.</p>
<p>Let’s look at two versions of <code>ICustomerRepository</code>. Which one is more understandable and specific? Obviously the second version is much better than the first one.</p>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomerRepository</span></span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token return-type class-name">Customer</span> <span class="token function">GetById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name">IReadOnlyList<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">></span><span class="token punctuation">></span></span> query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token class-name">Customer</span> customer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomerRepository</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRepository</span></span></span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token return-type class-name">Customer</span> <span class="token function">FindById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name">IReadOnlyList<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span> <span class="token function">FindByLastName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name">IReadOnlyList<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span> <span class="token function">FindByGender</span><span class="token punctuation">(</span><span class="token class-name">Gernder</span> gender<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddNewCustomer</span><span class="token punctuation">(</span><span class="token class-name">Customer</span> customer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>The <code>IRepository</code> is a <em>Marker Interface</em> that provides run-time type information about object.</p>
<h4 id="repository-and-specification-pattern" tabindex="-1">Repository and Specification Pattern <a class="direct-link" href="#repository-and-specification-pattern" aria-hidden="true">#</a></h4>
<blockquote>
<p>The central idea of Specification is to separate the statement of how to match a candidate, from the<br>
candidate object that it is matched against. As well as its usefulness in selection.</p>
<p><cite><a href="https://martinfowler.com/apsupp/spec.pdf">Specification Pattern</a></cite></p>
</blockquote>
<p>Imagine that you have a use-case that needs to select a subset of objects based on some criteria. If you want to be specific in a repository - based on  meaningful contract - the repository’s method will be too complicated. In this situation <em>Specification Pattern</em> can be helpful, it decouples the design of requirements and allows clear and declarative system definitions.</p>
<p>The Specification implementation in C# could be based on <code>interface</code> below:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"> <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span>
<span class="highlight-line"> <span class="token punctuation">{</span></span>
<span class="highlight-line">     <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsSatisfiedBy</span><span class="token punctuation">(</span><span class="token class-name">T</span> candidate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">     <span class="token return-type class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token function">And</span><span class="token punctuation">(</span><span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> other<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">     <span class="token return-type class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token function">AndNot</span><span class="token punctuation">(</span><span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> other<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">     <span class="token return-type class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token function">Or</span><span class="token punctuation">(</span><span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> other<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">     <span class="token return-type class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token function">OrNot</span><span class="token punctuation">(</span><span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> other<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">     <span class="token return-type class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token function">Not</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"> <span class="token punctuation">}</span></span></code></pre>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Specification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomerRepository</span></span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token keyword">public</span> <span class="token return-type class-name">IReadOnlyList<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span> <span class="token function">Find</span><span class="token punctuation">(</span><span class="token class-name">ISpecification<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span> specification<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerRepository</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICustomerRepository</span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>As you can see the main pillar of the pattern is <code>bool IsSatisfiedBy(T candidate)</code> that applies the condition to the collection. The rest methods are for composition.</p>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FineByCardTypeSpecification</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Specification<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FineByEmailSpecification</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Specification<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FineByGenderSpecification</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Specification<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FineByIdentitySpecification</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Specification<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FineByLastNameSpecification</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Specification<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token range operator">..</span><span class="token punctuation">.</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<pre class="language-csharp"><code class="language-csharp"><span class="highlight-line"><span class="token class-name"><span class="token keyword">var</span></span> emailSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FineByEmailSpecification</span><span class="token punctuation">(</span><span class="token string">"person@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token class-name"><span class="token keyword">var</span></span> cardTypeSpecification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FineByCardTypeSpecification</span><span class="token punctuation">(</span>CardTypes<span class="token punctuation">.</span>Visa<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token class-name"><span class="token keyword">var</span></span> genderSpecification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FineByGenderSpecification</span><span class="token punctuation">(</span>Gender<span class="token punctuation">.</span>Male<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token class-name"><span class="token keyword">var</span></span> customerRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token class-name"><span class="token keyword">var</span></span> firstResult <span class="token operator">=</span> customerRepository<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>emailSpec<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span>genderSpecification<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token class-name"><span class="token keyword">var</span></span> secondResult <span class="token operator">=</span> customerRepository<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>cardTypeSpecification<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span></code></pre>
<h4 id="general-repository-and-dao" tabindex="-1">General Repository and DAO <a class="direct-link" href="#general-repository-and-dao" aria-hidden="true">#</a></h4>
<p><em>General Repositories</em> tend to be <em>table-centric</em> which means they are an abstraction of data storage structure and concepts. <em>Data Access Object (DAO)</em> has the same definition. In my opinion there is no difference between <em>General Repository</em> and <em>DAO</em>. Sometimes it is considered to be an anti-pattern which I believe, it is half true. In the context of Domain Driven Design, Repository must be specific and has a contract, so General Repository should not be used, but not all applications must follow DDD principles, they can use General Repository to achieve their goals. Thus, General Repositories could be good in some situations and bad one when the Domain Model is used.</p>
<h4 id="summary" tabindex="-1">Summary <a class="direct-link" href="#summary" aria-hidden="true">#</a></h4>
<p><em>Repository Design Pattern</em> helps an application to persist <em>Domain Model</em>, it is closely related to it and should be specific and follows the contract. To perform a use-case, <em>Application Service Layer</em> exploits <em>Repository</em> and <em>Unit of Work</em>. To have a better <em>Repository</em>, implementing a <em>Specification Pattern</em> could be helpful. <em>General Repository</em> is like <em>DAO</em> and could be helpful if the <em>Domain Model</em> is not used.</p>

        </section>
    </article>
</div>
<div class="Box m-2 color-shadow-medium">
    <div class="Box-body">
        <h3><i class="icon-comment"></i> Comments</h3>
        <hr>
        <div class="flash-messages">
            <div class="flash">
                <p>Join the discussion for this article on <a href="https://github.com/abbasamiri/abbasamiri.github.io/issues/1" target="_blank">this
                        ticket</a>.
                </p>
            </div>
        </div>
        <div class="ml-6 pl-3" id="comment-container"></div>
    </div>
</div>

<script>
    const GH_API_URL = 'https://api.github.com/repos/abbasamiri/abbasamiri.github.io/issues/1/comments';
    let request = new XMLHttpRequest();
    request.open('GET', GH_API_URL, true);
    request.onload = function () {
        if (this.status >= 200 && this.status < 400) {
            let response = JSON.parse(this.response);

            for (let i = 0; i < response.length; i++) {
                document.getElementById('comment-container').appendChild(createCommentEl(response[i]));
            }
        } else {
            console.error(this);
        }
    };

    function createCommentEl(response) {
        let comment = document.createElement('div');
        comment.classList.add('TimelineItem')
        let date = new Date(response.created_at);
        let commentText = '';
        if (window.showdown) {
            let converter = new showdown.Converter();
            commentText = converter.makeHtml(response.body);
        }
        comment.innerHTML =
            '<div class="TimelineItem-avatar">\n' +
            '<img class="avatar" height="40" width="40" alt="@octocat"\n' +
            'src="' + response.user.avatar_url + '" />\n' +
            '</div>\n' +
            '<div class="TimelineItem-badge">\n' +
            '<i class="icon-comment" style="margin-top: 6px;margin-left: 2px;"></i>\n' +
            '</div>\n' +
            '<div class="TimelineItem-body">\n' +
            '<div class="Box">\n' +
            '<div class="Box-body">\n' +
            '<a href="' + response.html_url + '" class="mr-1" target="_blank">' +
            '<strong>' + response.user.login + '</strong> commented at ' + date.toLocaleString() +
            '</a>\n' +
            '<p>' + commentText + '</p>\n' +
            '</div>\n' +
            '</div>\n' +
            '</div>\n'
        return comment;
    }

    request.send();
</script>

    </div>
</div>
<footer class="Box-footer text-center">
    &copy; <span id="currentYear"></span> Abbas Amiri
</footer>
<script>
    (function () {
        document.getElementById('currentYear').innerText = (new Date()).getFullYear();
    })();
</script>
</body>
</html>
